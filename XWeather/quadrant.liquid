<style>

  .weather-icon {
    width: 5rem;
    height: 5rem;
    object-fit: contain;
  }
  
  .main-icon {
    width: 5rem;
    height: 5rem;
  }

  /* Responsive sizing based on container */
  .weather-icon-container {
    width: 100%;
    max-width: 200px;
    font-family: system-ui, -apple-system, sans-serif;
  }
  
  .weather-icon-container .weather-icon {
    width: 100%;
    height: auto;
    aspect-ratio: 1;
  }

  /* Main Layout Container */
  .weather-display {
    width: 100%;
    max-width: 350px;
    display: flex;
    flex-direction: column;
    gap: .5rem; /* Reduced gap */
  }

  /* Header Section */
  .header-section {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-bottom: 0.5rem; /* Reduced padding */
    gap: 1rem;
  }

  .location-block .location-title {
    font-size: 1.5rem;
    font-weight: bold;
    color: #111827;
    line-height: 1; /* Tighter line height */
  }

  .location-block .update-time {
    font-size: .75rem;
    font-weight: bold;
    color: #6b7280;
  }

  /* Temperature Display */
  .temp-section {
    display: flex;
    align-items: center;
  }

  .main-temp {
    font-size: 3rem;
    font-weight: bold;
    color: #111827;
    line-height: 1;
    text-align: right;
  }

  .feels-like-temp {
    font-size: .75rem;
    font-weight: bold;
    color: #6b7280;
    display: block;
    margin-top: 0; /* Reduced margin */
  }

  /* Weather Stats Grid */
  .stats-container {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    margin-top: 0rem;
    margin-left: .5rem;
    margin-right: .5rem;
  }

  /* Individual Stat Item */
  .stat-item {
    display: flex;
    align-items: center;
    gap: 1rem; /* Reduced gap */
    background: transparent;
    padding: 0;
    margin-top: .5rem;
  }

  .stat-icon {
    width: 2rem;
    height: 2rem;
    flex-shrink: 0;
  }

  .stat-content {
    display: flex;
    flex-direction: column;
  }

  .stat-title {
    font-size: 1rem;
    font-weight: bold;
    color: #6b7280;
    white-space: nowrap;
    line-height: 1;
  }

  .stat-number {
    font-size: 1.25rem;
    font-weight: bold;
    color: #111827;
    line-height: 1.1; /* Tighter line height */
  }

  .stat-unit {
    font-size: .75rem;
    font-weight: bold;
    color: #6b7280;
    margin-left: 0.25rem;
  }

  .stat-sub {
    font-size: .7rem;
    font-weight: bold;
    color: #6b7280;
    margin-top: 0; /* Reduced margin */
    line-height: 1;
  }

  /* Dynamic Icon Styling */
  .icon-bright { color: #111827; }
  .icon-medium { color: #4b5563; }
  .icon-dim { color: #6b7280; }

  /* Loading State */
  .loading-state {
    text-align: center;
    padding: 1rem; /* Reduced padding */
  }

  .loading-title {
    font-size: 2rem;
    font-weight: bold;
    color: #111827;
    margin-bottom: 0.5rem; /* Reduced margin */
  }

  .loading-message {
    font-size: 1.25rem;
    font-weight: bold;
    color: #6b7280;
  }
</style>

{%- comment -%}
  Icon Path Definitions from Erik Flowers' Weather Icons library.
{%- endcomment -%}

{%- assign icon_showers = 'M4.6,16.93c0-1.16,0.36-2.18,1.09-3.08c0.72-0.9,1.65-1.48,2.78-1.73c0.29-1.38,0.98-2.5,2.07-3.39S12.88,7.4,14.3,7.4
c1.39,0,2.63,0.43,3.72,1.28c1.08,0.85,1.79,1.95,2.12,3.3h0.34c0.9,0,1.73,0.22,2.48,0.66c0.76,0.44,1.35,1.04,1.79,1.8
c0.43,0.76,0.65,1.59,0.65,2.49c0,1.34-0.46,2.48-1.37,3.44c-0.92,0.96-2.04,1.46-3.37,1.5c-0.12,0-0.18-0.06-0.18-0.17v-1.34
c0-0.11,0.06-0.17,0.18-0.17c0.84-0.07,1.57-0.42,2.17-1.05s0.9-1.37,0.9-2.22c0-0.89-0.32-1.66-0.96-2.31
c-0.64-0.64-1.4-0.97-2.29-0.97h-1.63c-0.12,0-0.19-0.06-0.22-0.18l-0.07-0.57c-0.07-0.71-0.3-1.36-0.7-1.94s-0.91-1.03-1.53-1.36
c-0.62-0.33-1.3-0.49-2.02-0.49c-1.1,0-2.05,0.36-2.86,1.09c-0.81,0.73-1.27,1.64-1.37,2.72l-0.07,0.54c0,0.09-0.05,0.14-0.16,0.14
L9.31,13.7c-0.84,0.07-1.55,0.41-2.11,1.03c-0.57,0.62-0.85,1.35-0.85,2.2c0,0.87,0.3,1.62,0.89,2.25c0.59,0.63,1.31,0.97,2.17,1.02
c0.12,0,0.18,0.06,0.18,0.17v1.34c0,0.11-0.06,0.17-0.18,0.17c-0.66-0.03-1.28-0.18-1.88-0.45S6.42,20.8,6,20.36
c-0.43-0.44-0.77-0.95-1.02-1.55S4.6,17.59,4.6,16.93z M10.02,23.7c0-0.03,0.01-0.08,0.02-0.13s0.02-0.09,0.02-0.11l0.27-1.03
c0.07-0.22,0.2-0.4,0.4-0.51c0.2-0.12,0.41-0.14,0.64-0.07c0.23,0.07,0.4,0.2,0.52,0.4c0.12,0.2,0.14,0.41,0.07,0.64l-0.24,1.01
c-0.13,0.44-0.38,0.66-0.76,0.66c-0.03,0-0.05,0-0.09,0c-0.03,0-0.07-0.01-0.11-0.01c-0.04-0.01-0.07-0.01-0.1-0.01
c-0.21-0.06-0.37-0.18-0.48-0.34S10.02,23.86,10.02,23.7z M11.34,18.88c0-0.02,0-0.06,0.01-0.11c0.01-0.05,0.01-0.08,0.01-0.09
l0.3-1.05c0.06-0.19,0.17-0.34,0.32-0.45c0.15-0.1,0.31-0.15,0.47-0.15c0.02,0,0.05,0,0.08,0c0.03,0,0.06,0.01,0.09,0.01
c0.03,0.01,0.06,0.01,0.08,0.01c0.23,0.07,0.4,0.2,0.51,0.4c0.12,0.2,0.14,0.41,0.07,0.64l-0.24,1c-0.07,0.28-0.2,0.47-0.4,0.59
s-0.42,0.12-0.65,0.02c-0.22-0.06-0.38-0.17-0.49-0.34S11.34,19.04,11.34,18.88z M12.57,26.83c0-0.03,0.01-0.07,0.02-0.13
s0.02-0.09,0.02-0.12l0.29-0.99c0.06-0.24,0.2-0.42,0.4-0.54c0.2-0.12,0.42-0.15,0.65-0.08c0.23,0.07,0.39,0.2,0.51,0.41
s0.13,0.42,0.07,0.65l-0.25,1.04c-0.11,0.41-0.37,0.61-0.8,0.61c-0.05,0-0.13-0.01-0.24-0.04c-0.22-0.04-0.38-0.14-0.49-0.3
C12.63,27.18,12.57,27.01,12.57,26.83z M13.91,22.06c0-0.06,0.01-0.14,0.04-0.25l0.27-1.03c0.07-0.23,0.2-0.4,0.41-0.51
c0.2-0.12,0.42-0.14,0.65-0.07c0.23,0.06,0.39,0.19,0.51,0.39c0.11,0.2,0.13,0.41,0.06,0.65l-0.24,0.99
c-0.13,0.45-0.37,0.68-0.72,0.68c-0.04,0-0.15-0.02-0.31-0.06c-0.22-0.04-0.38-0.14-0.49-0.3C13.97,22.4,13.91,22.23,13.91,22.06z
 M16.73,23.74c0-0.07,0.01-0.15,0.03-0.24l0.28-0.99c0.07-0.24,0.2-0.42,0.41-0.54s0.41-0.15,0.63-0.09
c0.23,0.07,0.41,0.2,0.53,0.41c0.12,0.2,0.15,0.41,0.09,0.63l-0.29,1.06c-0.1,0.41-0.36,0.61-0.79,0.61c-0.09,0-0.18-0.01-0.26-0.03
c-0.2-0.04-0.35-0.14-0.46-0.3C16.8,24.08,16.74,23.91,16.73,23.74z M18.11,18.98c0-0.03,0.02-0.12,0.05-0.26l0.3-1.03
c0.04-0.21,0.13-0.37,0.29-0.47c0.16-0.1,0.32-0.15,0.49-0.14c0.04-0.01,0.13,0,0.24,0.03c0.22,0.05,0.39,0.18,0.52,0.38
c0.12,0.17,0.14,0.38,0.07,0.65l-0.24,1.03c-0.13,0.43-0.38,0.65-0.76,0.65c-0.06,0-0.17-0.02-0.34-0.06
c-0.21-0.06-0.36-0.17-0.46-0.31C18.16,19.29,18.11,19.14,18.11,18.98z' -%}

{%- assign icon_humidity = 'M7.56,17.19c0-0.88,0.24-1.89,0.72-3.03s1.1-2.25,1.86-3.31c1.56-2.06,2.92-3.62,4.06-4.67l0.75-0.72
c0.25,0.26,0.53,0.5,0.83,0.72c0.41,0.42,1.04,1.11,1.88,2.09s1.57,1.85,2.17,2.65c0.71,1.01,1.32,2.1,1.81,3.25
s0.74,2.16,0.74,3.03c0,1-0.19,1.95-0.58,2.86c-0.39,0.91-0.91,1.7-1.57,2.36c-0.66,0.66-1.45,1.19-2.37,1.58
c-0.92,0.39-1.89,0.59-2.91,0.59c-1,0-1.95-0.19-2.86-0.57c-0.91-0.38-1.7-0.89-2.36-1.55c-0.66-0.65-1.19-1.44-1.58-2.35
S7.56,18.23,7.56,17.19z M9.82,14.26c0,0.83,0.17,1.49,0.52,1.99c0.35,0.49,0.88,0.74,1.59,0.74c0.72,0,1.25-0.25,1.61-0.74
c0.35-0.49,0.53-1.15,0.54-1.99c-0.01-0.84-0.19-1.5-0.54-2c-0.35-0.49-0.89-0.74-1.61-0.74c-0.71,0-1.24,0.25-1.59,0.74
C9.99,12.76,9.82,13.42,9.82,14.26z M11.39,14.26c0-0.15,0-0.27,0-0.35s0.01-0.19,0.02-0.33c0.01-0.14,0.02-0.25,0.05-0.32
s0.05-0.16,0.09-0.24c0.04-0.08,0.09-0.15,0.15-0.18c0.07-0.04,0.14-0.06,0.23-0.06c0.14,0,0.25,0.04,0.33,0.12s0.14,0.21,0.17,0.38
c0.03,0.18,0.05,0.32,0.06,0.45s0.01,0.3,0.01,0.52c0,0.23,0,0.4-0.01,0.52c-0.01,0.12-0.03,0.27-0.06,0.45
c-0.03,0.17-0.09,0.3-0.17,0.38s-0.19,0.12-0.33,0.12c-0.09,0-0.16-0.02-0.23-0.06c-0.07-0.04-0.12-0.1-0.15-0.18
c-0.04-0.08-0.07-0.17-0.09-0.24c-0.02-0.08-0.04-0.19-0.05-0.32c-0.01-0.14-0.02-0.25-0.02-0.32S11.39,14.41,11.39,14.26z
 M11.98,22.01h1.32l4.99-10.74h-1.35L11.98,22.01z M16.28,19.02c0.01,0.84,0.2,1.5,0.55,2c0.35,0.49,0.89,0.74,1.6,0.74
c0.72,0,1.25-0.25,1.6-0.74c0.35-0.49,0.52-1.16,0.53-2c-0.01-0.84-0.18-1.5-0.53-1.99c-0.35-0.49-0.88-0.74-1.6-0.74
c-0.71,0-1.25,0.25-1.6,0.74C16.47,17.52,16.29,18.18,16.28,19.02z M17.85,19.02c0-0.23,0-0.4,0.01-0.52
c0.01-0.12,0.03-0.27,0.06-0.45s0.09-0.3,0.17-0.38s0.19-0.12,0.33-0.12c0.09,0,0.17,0.02,0.24,0.06c0.07,0.04,0.12,0.1,0.16,0.19
c0.04,0.09,0.07,0.17,0.1,0.24s0.04,0.18,0.05,0.32l0.01,0.32l0,0.34c0,0.16,0,0.28,0,0.35l-0.01,0.32l-0.05,0.32l-0.1,0.24
l-0.16,0.19l-0.24,0.06c-0.14,0-0.25-0.04-0.33-0.12s-0.14-0.21-0.17-0.38c-0.03-0.18-0.05-0.33-0.06-0.45S17.85,19.25,17.85,19.02z' -%}

{%- assign icon_barometer = 'M7.69,13.2c0-0.99,0.19-1.94,0.58-2.85c0.39-0.91,0.91-1.68,1.57-2.33s1.44-1.17,2.34-1.56c0.9-0.39,1.85-0.58,2.84-0.58
c0.99,0,1.94,0.19,2.85,0.58c0.9,0.39,1.68,0.91,2.33,1.56c0.65,0.65,1.17,1.43,1.56,2.33s0.58,1.85,0.58,2.85
c0,1.62-0.48,3.06-1.44,4.34c-0.96,1.27-2.2,2.14-3.71,2.61v3.29h-4.24v-3.25c-1.54-0.45-2.81-1.32-3.79-2.61S7.69,14.83,7.69,13.2z
 M9.3,13.2c0,1.55,0.56,2.88,1.69,3.99c1.11,1.12,2.45,1.68,4.02,1.68c1.03,0,1.99-0.25,2.86-0.76c0.88-0.51,1.57-1.2,2.09-2.07
c0.51-0.87,0.77-1.82,0.77-2.85c0-0.77-0.15-1.5-0.45-2.21s-0.71-1.31-1.22-1.82c-0.51-0.51-1.12-0.92-1.83-1.22
c-0.71-0.3-1.44-0.45-2.21-0.45c-0.77,0-1.5,0.15-2.21,0.45s-1.31,0.71-1.82,1.22c-0.51,0.51-0.92,1.12-1.22,1.82
C9.45,11.7,9.3,12.43,9.3,13.2z M9.88,13.56v-0.72h2.17v0.72H9.88z M10.97,10.02l0.52-0.52l1.52,1.52l-0.52,0.53L10.97,10.02z
 M13.5,14.95c0-0.42,0.15-0.78,0.44-1.09c0.29-0.31,0.65-0.47,1.06-0.48l2.73-4.49l0.66,0.35l-2.02,4.83
c0.18,0.25,0.26,0.54,0.26,0.88c0,0.44-0.15,0.81-0.46,1.11c-0.31,0.3-0.68,0.45-1.12,0.45c-0.43,0-0.8-0.15-1.1-0.45
C13.65,15.76,13.5,15.39,13.5,14.95z M14.81,10.28V8.12h0.69v2.17H14.81z M17.75,13.55v-0.74h2.17v0.74H17.75z' -%}

{%- assign icon_horizon_alt = 'M4.11,15.9c0-0.26,0.09-0.47,0.27-0.62c0.14-0.15,0.35-0.23,0.62-0.23h2.08c0.24,0,0.45,0.08,0.6,0.24
c0.16,0.16,0.24,0.36,0.24,0.6c0,0.24-0.08,0.44-0.24,0.61c-0.16,0.17-0.36,0.25-0.6,0.25H5c-0.24,0-0.45-0.08-0.63-0.25
C4.19,16.34,4.11,16.14,4.11,15.9z M5.03,20.98c0-0.23,0.09-0.43,0.26-0.61c0.16-0.16,0.37-0.23,0.61-0.23h18.21
c0.24,0,0.45,0.08,0.62,0.24c0.17,0.16,0.25,0.36,0.25,0.6c0,0.24-0.09,0.44-0.26,0.61s-0.38,0.26-0.61,0.26H5.91
c-0.24,0-0.44-0.09-0.61-0.26S5.03,21.22,5.03,20.98z M7.08,8.81c0-0.26,0.08-0.45,0.23-0.59c0.17-0.18,0.38-0.27,0.62-0.27
c0.24,0,0.44,0.09,0.61,0.27l1.44,1.46c0.18,0.16,0.26,0.36,0.26,0.6c0,0.25-0.08,0.45-0.24,0.61s-0.36,0.24-0.6,0.24
c-0.22,0-0.42-0.08-0.6-0.24L7.31,9.42C7.16,9.28,7.08,9.08,7.08,8.81z M9.68,15.9c0,0.87,0.18,1.65,0.53,2.33
c0.03,0.09,0.11,0.14,0.24,0.14h1.67c0.07,0,0.12-0.02,0.14-0.06c0.02-0.04-0.01-0.1-0.07-0.16c-0.53-0.65-0.8-1.4-0.8-2.25
c0-0.99,0.36-1.84,1.07-2.54c0.71-0.7,1.56-1.05,2.55-1.05c0.99,0,1.84,0.35,2.55,1.05s1.05,1.55,1.05,2.54
c0,0.86-0.27,1.61-0.8,2.25c-0.04,0.06-0.06,0.1-0.06,0.12c-0.01,0.03,0,0.06,0.03,0.07c0.02,0.02,0.06,0.03,0.1,0.03h1.7
c0.09,0,0.16-0.05,0.21-0.14c0.38-0.71,0.56-1.48,0.56-2.33c0-0.96-0.24-1.85-0.72-2.67c-0.48-0.82-1.13-1.47-1.95-1.95
s-1.71-0.72-2.67-0.72s-1.85,0.24-2.67,0.72c-0.82,0.48-1.47,1.13-1.95,1.95C9.91,14.05,9.68,14.94,9.68,15.9z M14.15,7.97V5.88
c0-0.24,0.08-0.44,0.25-0.62C14.57,5.08,14.77,5,15.01,5c0.24,0,0.44,0.09,0.62,0.26c0.17,0.17,0.26,0.38,0.26,0.62v2.09
c0,0.24-0.09,0.44-0.26,0.62c-0.18,0.18-0.38,0.26-0.62,0.26c-0.24,0-0.44-0.09-0.61-0.26C14.23,8.41,14.15,8.21,14.15,7.97z
 M19.77,10.28c0-0.24,0.08-0.44,0.24-0.6l1.44-1.46c0.17-0.18,0.38-0.27,0.62-0.27c0.25,0,0.46,0.08,0.62,0.25
c0.17,0.17,0.25,0.37,0.25,0.61c0,0.26-0.08,0.46-0.23,0.61l-1.51,1.47c-0.16,0.15-0.36,0.22-0.59,0.22
c-0.25,0.01-0.45-0.07-0.61-0.22C19.85,10.74,19.77,10.53,19.77,10.28z M22.1,15.9c0-0.27,0.08-0.47,0.24-0.62
c0.14-0.15,0.34-0.23,0.59-0.23h2.09c0.24,0,0.45,0.08,0.62,0.24c0.17,0.16,0.26,0.36,0.26,0.6c0,0.24-0.09,0.44-0.26,0.61
c-0.18,0.17-0.38,0.25-0.62,0.25h-2.09c-0.23,0-0.43-0.08-0.59-0.25C22.18,16.34,22.1,16.14,22.1,15.9z' -%}

{%- assign icon_lightning = 'M7.96,24.51h0.39l6.88-10.18c0.09-0.18,0.04-0.27-0.15-0.27h-2.84l2.99-5.45c0.09-0.18,0.02-0.27-0.2-0.27h-3.81
c-0.11,0-0.2,0.06-0.29,0.18l-2.78,7.4c-0.02,0.18,0.04,0.27,0.19,0.27h2.75L7.96,24.51z M16.46,18.18h0.27l5.22-7.67
c0.05-0.08,0.06-0.15,0.04-0.2s-0.08-0.07-0.17-0.07h-2.1l2.18-4.03c0.12-0.2,0.06-0.3-0.18-0.3h-2.74c-0.13,0-0.23,0.06-0.3,0.19
l-2.08,5.48c-0.03,0.09-0.03,0.16,0.01,0.21c0.04,0.05,0.1,0.07,0.19,0.07h2.04L16.46,18.18z' -%}

{%- assign icon_hot = 'M4.14,14.76c0-0.24,0.09-0.44,0.27-0.61c0.17-0.17,0.38-0.25,0.62-0.25h2.06c0.24,0,0.44,0.08,0.6,0.25
c0.17,0.17,0.25,0.37,0.25,0.61c0,0.25-0.08,0.46-0.25,0.63c-0.17,0.17-0.37,0.25-0.6,0.25H5.03c-0.25,0-0.46-0.08-0.63-0.25
C4.22,15.22,4.14,15.01,4.14,14.76z M7.06,7.74c0-0.23,0.08-0.44,0.24-0.62C7.5,6.96,7.71,6.87,7.96,6.87
c0.21,0,0.41,0.08,0.59,0.25l1.45,1.48c0.17,0.16,0.25,0.36,0.25,0.6c0,0.24-0.08,0.44-0.25,0.6c-0.17,0.17-0.36,0.25-0.6,0.25
c-0.26,0-0.46-0.08-0.61-0.25l-1.5-1.44C7.15,8.19,7.06,7.98,7.06,7.74z M9.67,14.76c0-0.71,0.14-1.39,0.43-2.04
c0.28-0.65,0.67-1.22,1.14-1.69c0.48-0.47,1.05-0.85,1.7-1.13S14.28,9.47,15,9.47c0.96,0,1.84,0.24,2.66,0.72
c0.82,0.48,1.47,1.12,1.94,1.94c0.47,0.81,0.71,1.69,0.71,2.63c0,0.15-0.01,0.29-0.03,0.42c-0.28-0.17-0.6-0.25-0.97-0.25
c-0.24,0-0.48,0.05-0.72,0.15c0.01-0.07,0.01-0.18,0.01-0.32c0-0.98-0.35-1.81-1.06-2.5c-0.71-0.69-1.56-1.04-2.55-1.04
c-0.99,0-1.83,0.35-2.54,1.04s-1.05,1.52-1.05,2.5v0.18c-0.29,0.02-0.57,0.1-0.84,0.25c-0.01,0.01-0.04,0.03-0.1,0.07
s-0.12,0.09-0.19,0.14s-0.14,0.11-0.23,0.19s-0.18,0.16-0.26,0.24C9.7,15.51,9.67,15.15,9.67,14.76z M9.7,18.41v-0.15
c-0.01-0.09,0-0.2,0.02-0.33c0.05-0.36,0.19-0.7,0.42-1.02c0.13-0.16,0.22-0.27,0.27-0.31c0.01-0.02,0.02-0.04,0.04-0.06l0.04-0.04
c0.03-0.01,0.07-0.05,0.12-0.1c0.02-0.02,0.05-0.05,0.08-0.08s0.06-0.04,0.07-0.06c0.05-0.05,0.1-0.08,0.14-0.1l0.17-0.11
c0.14-0.09,0.31-0.14,0.5-0.14h0.03c0.1,0,0.19,0.01,0.26,0.03c0.03,0.01,0.07,0.03,0.13,0.07v0.01c0.14,0.06,0.26,0.16,0.34,0.29
c0.08,0.13,0.13,0.27,0.13,0.42c0,0.17-0.05,0.31-0.14,0.42c-0.06,0.09-0.14,0.17-0.22,0.23c-0.02,0.01-0.04,0.02-0.06,0.03
c-0.02,0.01-0.04,0.02-0.04,0.02l-0.06,0.04c-0.04,0.03-0.07,0.06-0.1,0.08s-0.06,0.06-0.11,0.11c-0.04,0.05-0.08,0.09-0.11,0.14
c-0.03,0.04-0.06,0.1-0.09,0.15c-0.03,0.06-0.05,0.12-0.05,0.17v0.15c0.04,0.15,0.08,0.27,0.11,0.36c0.07,0.14,0.18,0.28,0.34,0.44
c0.01,0.02,0.09,0.1,0.24,0.25c0.86,0.78,1.27,1.62,1.21,2.5c-0.02,0.3-0.09,0.59-0.21,0.87c-0.12,0.28-0.26,0.51-0.43,0.7
c-0.16,0.19-0.29,0.33-0.39,0.43c-0.1,0.09-0.18,0.16-0.25,0.21c-0.01,0.01-0.03,0.02-0.06,0.04c-0.03,0.02-0.06,0.04-0.07,0.04
c-0.08,0.04-0.15,0.06-0.22,0.07c-0.09,0.01-0.15,0.02-0.2,0.02c-0.3,0-0.54-0.1-0.71-0.3c-0.14-0.17-0.2-0.37-0.18-0.59
c0.02-0.22,0.13-0.4,0.33-0.53L11,22.75c0.01-0.01,0.03-0.03,0.05-0.04c0.02-0.02,0.04-0.04,0.07-0.06
c0.03-0.02,0.06-0.05,0.08-0.08c0.03-0.03,0.06-0.07,0.08-0.1c0.03-0.04,0.06-0.08,0.08-0.12c0.03-0.04,0.06-0.09,0.08-0.14
c0.03-0.05,0.05-0.1,0.07-0.15c0.02-0.05,0.03-0.1,0.05-0.16c0.01-0.06,0.02-0.12,0.02-0.17c0.02-0.2-0.03-0.4-0.15-0.6
c-0.05-0.11-0.12-0.22-0.22-0.33c-0.07-0.08-0.12-0.13-0.15-0.16c-0.09-0.11-0.14-0.17-0.15-0.18c-0.02-0.01-0.04-0.03-0.07-0.06
s-0.05-0.04-0.06-0.05c-0.15-0.14-0.26-0.26-0.34-0.36c-0.12-0.16-0.21-0.26-0.24-0.32c-0.19-0.26-0.32-0.52-0.39-0.78
c-0.04-0.14-0.07-0.25-0.08-0.32c0-0.02-0.01-0.05-0.02-0.08S9.7,18.44,9.7,18.41z M13.58,18.08c0-0.06,0-0.1,0.01-0.14
c0.02-0.22,0.09-0.43,0.2-0.64c0.11-0.21,0.22-0.39,0.35-0.53c0.13-0.14,0.25-0.27,0.38-0.38s0.23-0.19,0.31-0.25l0.12-0.07
c0.15-0.09,0.32-0.14,0.5-0.14c0.11,0,0.21,0.01,0.3,0.03c0.01,0,0.02,0.01,0.05,0.02c0.03,0.02,0.05,0.03,0.06,0.04
c0.01,0,0.02,0,0.03,0.01c0.01,0,0.03,0.02,0.07,0.05c0.2,0.12,0.32,0.3,0.38,0.54c0,0.02,0,0.04,0,0.07c0,0.02,0,0.04,0,0.05
c0,0.03-0.01,0.07-0.02,0.12s-0.02,0.08-0.02,0.09c-0.07,0.23-0.21,0.39-0.42,0.5c-0.33,0.22-0.51,0.45-0.53,0.69
c-0.01,0.08-0.01,0.15,0,0.22c0.02,0.12,0.08,0.25,0.17,0.39c0.11,0.16,0.19,0.27,0.24,0.32c0.16,0.16,0.25,0.25,0.28,0.27
c0.12,0.11,0.28,0.28,0.47,0.51c0.54,0.65,0.79,1.32,0.74,2c-0.02,0.3-0.09,0.59-0.21,0.87c-0.12,0.28-0.26,0.51-0.43,0.7
c-0.16,0.18-0.3,0.33-0.4,0.43c-0.11,0.1-0.19,0.17-0.25,0.21l-0.12,0.08c-0.11,0.04-0.17,0.06-0.21,0.07
c-0.11,0.01-0.18,0.02-0.2,0.02h-0.03c-0.08,0-0.14-0.01-0.19-0.02c-0.02,0-0.05,0-0.08-0.01c-0.03-0.01-0.06-0.01-0.07-0.01
c-0.01,0-0.02,0-0.03-0.01c-0.01-0.01-0.02-0.01-0.04-0.02c-0.01-0.01-0.02-0.01-0.03-0.01c-0.15-0.11-0.24-0.17-0.26-0.21
c-0.16-0.18-0.22-0.38-0.19-0.6c0.03-0.22,0.14-0.39,0.34-0.53l0.03-0.04c0.02-0.02,0.05-0.05,0.09-0.08l0.12-0.12l0.13-0.16
l0.12-0.19l0.09-0.22l0.04-0.24c0.01-0.4-0.22-0.82-0.69-1.27c-0.19-0.17-0.33-0.31-0.44-0.43C13.79,19.37,13.54,18.72,13.58,18.08z
 M14.12,6.92V4.85c0-0.24,0.09-0.45,0.26-0.62c0.17-0.17,0.38-0.25,0.61-0.25c0.24,0,0.45,0.08,0.62,0.25
c0.17,0.17,0.25,0.38,0.25,0.62v2.07c0,0.24-0.08,0.43-0.25,0.59S15.24,7.74,15,7.74c-0.24,0-0.44-0.08-0.61-0.23
C14.21,7.35,14.12,7.16,14.12,6.92z M17.48,17.93c0.02-0.22,0.09-0.43,0.2-0.64c0.11-0.21,0.22-0.39,0.35-0.53
c0.13-0.14,0.25-0.27,0.38-0.38c0.12-0.11,0.22-0.19,0.3-0.25l0.13-0.07c0.02-0.02,0.06-0.04,0.1-0.08
c0.11-0.04,0.24-0.07,0.38-0.07c0.34,0,0.59,0.13,0.77,0.38c0.05,0.07,0.08,0.14,0.1,0.23c0.01,0.02,0.02,0.05,0.02,0.08v0.11
c0,0.31-0.15,0.55-0.45,0.7c-0.32,0.21-0.49,0.44-0.52,0.69c-0.04,0.34,0.19,0.74,0.68,1.2c0.88,0.77,1.28,1.61,1.23,2.5
c-0.02,0.3-0.09,0.59-0.21,0.87c-0.12,0.28-0.27,0.51-0.43,0.7c-0.17,0.19-0.3,0.33-0.39,0.43s-0.18,0.16-0.25,0.21
c-0.16,0.1-0.3,0.15-0.41,0.16c-0.03,0.01-0.08,0.01-0.15,0.01c-0.3,0-0.53-0.1-0.69-0.3c-0.15-0.17-0.21-0.37-0.19-0.59
s0.13-0.4,0.32-0.53c0.03-0.01,0.09-0.06,0.18-0.14s0.18-0.21,0.29-0.38c0.1-0.18,0.16-0.35,0.17-0.53c0.02-0.4-0.22-0.82-0.7-1.27
c-0.41-0.36-0.73-0.75-0.94-1.16C17.51,18.86,17.42,18.4,17.48,17.93z M19.77,9.21c0-0.25,0.08-0.45,0.23-0.6l1.46-1.48
c0.18-0.17,0.38-0.25,0.61-0.25c0.24,0,0.44,0.09,0.61,0.26s0.26,0.38,0.26,0.61c0,0.25-0.09,0.46-0.26,0.62l-1.48,1.44
c-0.18,0.17-0.38,0.25-0.61,0.25c-0.23,0-0.43-0.08-0.58-0.25C19.85,9.65,19.77,9.44,19.77,9.21z M22.07,14.76
c0-0.22,0.09-0.42,0.26-0.61c0.16-0.17,0.35-0.25,0.58-0.25h2.06c0.24,0,0.45,0.09,0.62,0.26s0.27,0.37,0.27,0.6
c0,0.24-0.09,0.45-0.26,0.62c-0.18,0.17-0.38,0.26-0.63,0.26h-2.06c-0.24,0-0.45-0.08-0.6-0.25C22.15,15.22,22.07,15.01,22.07,14.76
z' -%}

{%- assign icon_thermometer = 'M9.91,19.56c0-0.85,0.2-1.64,0.59-2.38s0.94-1.35,1.65-1.84V5.42c0-0.8,0.27-1.48,0.82-2.03S14.2,2.55,15,2.55
c0.81,0,1.49,0.28,2.04,0.83c0.55,0.56,0.83,1.23,0.83,2.03v9.92c0.71,0.49,1.25,1.11,1.64,1.84s0.58,1.53,0.58,2.38
c0,0.92-0.23,1.78-0.68,2.56s-1.07,1.4-1.85,1.85s-1.63,0.68-2.56,0.68c-0.92,0-1.77-0.23-2.55-0.68s-1.4-1.07-1.86-1.85
S9.91,20.48,9.91,19.56z M11.67,19.56c0,0.93,0.33,1.73,0.98,2.39c0.65,0.66,1.44,0.99,2.36,0.99c0.93,0,1.73-0.33,2.4-1
s1.01-1.46,1.01-2.37c0-0.62-0.16-1.2-0.48-1.73c-0.32-0.53-0.76-0.94-1.32-1.23l-0.28-0.14c-0.1-0.04-0.15-0.14-0.15-0.29V5.42
c0-0.32-0.11-0.59-0.34-0.81C15.62,4.4,15.34,4.29,15,4.29c-0.32,0-0.6,0.11-0.83,0.32c-0.23,0.21-0.34,0.48-0.34,0.81v10.74
c0,0.15-0.05,0.25-0.14,0.29l-0.27,0.14c-0.55,0.29-0.98,0.7-1.29,1.23C11.82,18.35,11.67,18.92,11.67,19.56z M12.45,19.56
c0,0.71,0.24,1.32,0.73,1.82s1.07,0.75,1.76,0.75s1.28-0.25,1.79-0.75c0.51-0.5,0.76-1.11,0.76-1.81c0-0.63-0.22-1.19-0.65-1.67
c-0.43-0.48-0.96-0.77-1.58-0.85V9.69c0-0.06-0.03-0.13-0.1-0.19c-0.07-0.07-0.14-0.1-0.22-0.1c-0.09,0-0.16,0.03-0.21,0.08
c-0.05,0.06-0.08,0.12-0.08,0.21v7.34c-0.61,0.09-1.13,0.37-1.56,0.85C12.66,18.37,12.45,18.92,12.45,19.56z' -%}

{%  assign icon_wind_deg = 'M3.74,14.5c0-2.04,0.51-3.93,1.52-5.66s2.38-3.1,4.11-4.11s3.61-1.51,5.64-1.51c1.52,0,2.98,0.3,4.37,0.89
s2.58,1.4,3.59,2.4s1.81,2.2,2.4,3.6s0.89,2.85,0.89,4.39c0,1.52-0.3,2.98-0.89,4.37s-1.4,2.59-2.4,3.59s-2.2,1.8-3.59,2.39
s-2.84,0.89-4.37,0.89c-1.53,0-3-0.3-4.39-0.89s-2.59-1.4-3.6-2.4s-1.8-2.2-2.4-3.58S3.74,16.03,3.74,14.5z M6.22,14.5
c0,2.37,0.86,4.43,2.59,6.18c1.73,1.73,3.79,2.59,6.2,2.59c1.58,0,3.05-0.39,4.39-1.18s2.42-1.85,3.21-3.2s1.19-2.81,1.19-4.39
s-0.4-3.05-1.19-4.4s-1.86-2.42-3.21-3.21s-2.81-1.18-4.39-1.18s-3.05,0.39-4.39,1.18S8.2,8.75,7.4,10.1S6.22,12.92,6.22,14.5z
 M11.11,20.35l3.75-13.11c0.01-0.1,0.06-0.15,0.15-0.15s0.14,0.05,0.15,0.15l3.74,13.11c0.04,0.11,0.03,0.19-0.02,0.25
s-0.13,0.06-0.24,0l-3.47-1.3c-0.1-0.04-0.2-0.04-0.29,0l-3.5,1.3c-0.1,0.06-0.17,0.06-0.21,0S11.09,20.45,11.11,20.35z' -%}

{%- if response -%}
  {%- assign wind_direction = response.ob.windDir -%}
  {%- case wind_direction -%}
    {%- when 'N' -%}{%- assign wind_rotation = "transform: rotate(180deg);" -%}
    {%- when 'NNE' -%}{%- assign wind_rotation = "transform: rotate(202.5deg);" -%}
    {%- when 'NE' -%}{%- assign wind_rotation = "transform: rotate(225deg);" -%}
    {%- when 'ENE' -%}{%- assign wind_rotation = "transform: rotate(247.5deg);" -%}
    {%- when 'E' -%}{%- assign wind_rotation = "transform: rotate(270deg);" -%}
    {%- when 'ESE' -%}{%- assign wind_rotation = "transform: rotate(292.5deg);" -%}
    {%- when 'SE' -%}{%- assign wind_rotation = "transform: rotate(315deg);" -%}
    {%- when 'SSE' -%}{%- assign wind_rotation = "transform: rotate(337.5deg);" -%}
    {%- when 'S' -%}{%- assign wind_rotation = "transform: rotate(0deg);" -%}
    {%- when 'SSW' -%}{%- assign wind_rotation = "transform: rotate(22.5deg);" -%}
    {%- when 'SW' -%}{%- assign wind_rotation = "transform: rotate(45deg);" -%}
    {%- when 'WSW' -%}{%- assign wind_rotation = "transform: rotate(67.5deg);" -%}
    {%- when 'W' -%}{%- assign wind_rotation = "transform: rotate(90deg);" -%}
    {%- when 'WNW' -%}{%- assign wind_rotation = "transform: rotate(112.5deg);" -%}
    {%- when 'NW' -%}{%- assign wind_rotation = "transform: rotate(135deg);" -%}
    {%- when 'NNW' -%}{%- assign wind_rotation = "transform: rotate(157.5deg);" -%}
    {%- else -%}{%- assign wind_rotation = "" -%}
  {%- endcase -%}

  {% comment %}
  TRMNL Weather Icon Mapping
  Maps Xweather API weather codes to TRMNL weather icons
  {% endcomment %}
  
<!-- COMPREHENSIVE WEATHER MAPPING -->
{% assign weather_coded = response.ob.weatherCoded %}
{% assign clouds_coded = response.ob.cloudsCoded %}
{% assign is_day = response.ob.isDay %}
{% assign weather_parts = weather_coded | split: ':' %}
{% assign coverage = weather_parts[0] %}
{% assign intensity = weather_parts[1] %}
{% assign weather_type = weather_parts[2] %}

{% assign weather_icon = '' %}

<!-- PRECIPITATION & WEATHER PHENOMENA (Higher Priority) -->
{% if weather_type == 'R' %}
  {% comment %} RAIN {% endcomment %}
  {% if intensity == 'VH' or intensity == 'H' %}
    {% if is_day %}{% assign weather_icon = 'wi-day-rain' %}{% else %}{% assign weather_icon = 'wi-night-alt-rain' %}{% endif %}
  {% elsif intensity == 'L' or intensity == 'VL' %}
    {% if is_day %}{% assign weather_icon = 'wi-day-sprinkle' %}{% else %}{% assign weather_icon = 'wi-night-alt-sprinkle' %}{% endif %}
  {% else %}
    {% if is_day %}{% assign weather_icon = 'wi-day-rain' %}{% else %}{% assign weather_icon = 'wi-night-alt-rain' %}{% endif %}
  {% endif %}

{% elsif weather_type == 'RW' %}
  {% comment %} RAIN SHOWERS {% endcomment %}
  {% if coverage == 'S' or coverage == 'C' %}
    {% comment %} Slight chance or chance of showers {% endcomment %}
    {% if is_day %}{% assign weather_icon = 'wi-day-showers' %}{% else %}{% assign weather_icon = 'wi-night-alt-showers' %}{% endif %}
  {% elsif intensity == 'H' or intensity == 'VH' %}
    {% comment %} Heavy showers {% endcomment %}
    {% if is_day %}{% assign weather_icon = 'wi-day-storm-showers' %}{% else %}{% assign weather_icon = 'wi-night-alt-storm-showers' %}{% endif %}
  {% elsif coverage == 'WD' or coverage == 'D' %}
    {% comment %} Widespread or definite showers {% endcomment %}
    {% if is_day %}{% assign weather_icon = 'wi-day-rain' %}{% else %}{% assign weather_icon = 'wi-night-alt-rain' %}{% endif %}
  {% else %}
    {% if is_day %}{% assign weather_icon = 'wi-day-showers' %}{% else %}{% assign weather_icon = 'wi-night-alt-showers' %}{% endif %}
  {% endif %}

{% elsif weather_type == 'L' %}
  {% comment %} DRIZZLE {% endcomment %}
  {% if is_day %}{% assign weather_icon = 'wi-day-sprinkle' %}{% else %}{% assign weather_icon = 'wi-night-alt-sprinkle' %}{% endif %}

{% elsif weather_type == 'ZL' %}
  {% comment %} FREEZING DRIZZLE {% endcomment %}
  {% if is_day %}{% assign weather_icon = 'wi-day-sleet' %}{% else %}{% assign weather_icon = 'wi-night-alt-sleet' %}{% endif %}

{% elsif weather_type == 'ZR' %}
  {% comment %} FREEZING RAIN {% endcomment %}
  {% if intensity == 'H' or intensity == 'VH' %}
    {% if is_day %}{% assign weather_icon = 'wi-day-sleet-storm' %}{% else %}{% assign weather_icon = 'wi-night-alt-sleet-storm' %}{% endif %}
  {% else %}
    {% if is_day %}{% assign weather_icon = 'wi-day-sleet' %}{% else %}{% assign weather_icon = 'wi-night-alt-sleet' %}{% endif %}
  {% endif %}

{% elsif weather_type == 'S' %}
  {% comment %} SNOW {% endcomment %}
  {% if intensity == 'VH' or intensity == 'H' %}
    {% if is_day %}{% assign weather_icon = 'wi-day-snow-wind' %}{% else %}{% assign weather_icon = 'wi-night-alt-snow-wind' %}{% endif %}
  {% elsif intensity == 'L' or intensity == 'VL' %}
    {% if coverage == 'S' or coverage == 'C' %}
      {% comment %} Light snow flurries {% endcomment %}
      {% if is_day %}{% assign weather_icon = 'wi-day-snow' %}{% else %}{% assign weather_icon = 'wi-night-alt-snow' %}{% endif %}
    {% else %}
      {% if is_day %}{% assign weather_icon = 'wi-day-snow' %}{% else %}{% assign weather_icon = 'wi-night-alt-snow' %}{% endif %}
    {% endif %}
  {% else %}
    {% if is_day %}{% assign weather_icon = 'wi-day-snow' %}{% else %}{% assign weather_icon = 'wi-night-alt-snow' %}{% endif %}
  {% endif %}

{% elsif weather_type == 'SW' %}
  {% comment %} SNOW SHOWERS {% endcomment %}
  {% if intensity == 'H' or intensity == 'VH' %}
    {% if is_day %}{% assign weather_icon = 'wi-day-snow-wind' %}{% else %}{% assign weather_icon = 'wi-night-alt-snow-wind' %}{% endif %}
  {% else %}
    {% if is_day %}{% assign weather_icon = 'wi-day-snow' %}{% else %}{% assign weather_icon = 'wi-night-alt-snow' %}{% endif %}
  {% endif %}

{% elsif weather_type == 'BS' %}
  {% comment %} BLOWING SNOW {% endcomment %}
  {% if is_day %}{% assign weather_icon = 'wi-day-snow-wind' %}{% else %}{% assign weather_icon = 'wi-night-alt-snow-wind' %}{% endif %}

{% elsif weather_type == 'IP' %}
  {% comment %} ICE PELLETS / SLEET {% endcomment %}
  {% if intensity == 'H' or intensity == 'VH' %}
    {% if is_day %}{% assign weather_icon = 'wi-day-sleet-storm' %}{% else %}{% assign weather_icon = 'wi-night-alt-sleet-storm' %}{% endif %}
  {% else %}
    {% if is_day %}{% assign weather_icon = 'wi-day-sleet' %}{% else %}{% assign weather_icon = 'wi-night-alt-sleet' %}{% endif %}
  {% endif %}

{% elsif weather_type == 'RS' %}
  {% comment %} RAIN/SNOW MIX {% endcomment %}
  {% if is_day %}{% assign weather_icon = 'wi-day-rain-mix' %}{% else %}{% assign weather_icon = 'wi-night-alt-rain-mix' %}{% endif %}

{% elsif weather_type == 'SI' %}
  {% comment %} SNOW/SLEET MIX {% endcomment %}
  {% if is_day %}{% assign weather_icon = 'wi-day-sleet' %}{% else %}{% assign weather_icon = 'wi-night-alt-sleet' %}{% endif %}

{% elsif weather_type == 'WM' %}
  {% comment %} WINTRY MIX {% endcomment %}
  {% if is_day %}{% assign weather_icon = 'wi-day-rain-mix' %}{% else %}{% assign weather_icon = 'wi-night-alt-rain-mix' %}{% endif %}

{% elsif weather_type == 'T' %}
  {% comment %} THUNDERSTORMS {% endcomment %}
  {% if intensity == 'VH' or intensity == 'H' %}
    {% if is_day %}{% assign weather_icon = 'wi-day-thunderstorm' %}{% else %}{% assign weather_icon = 'wi-night-alt-thunderstorm' %}{% endif %}
  {% elsif coverage == 'S' or coverage == 'C' %}
    {% comment %} Chance of thunderstorms {% endcomment %}
    {% if is_day %}{% assign weather_icon = 'wi-day-lightning' %}{% else %}{% assign weather_icon = 'wi-night-alt-lightning' %}{% endif %}
  {% else %}
    {% if is_day %}{% assign weather_icon = 'wi-day-thunderstorm' %}{% else %}{% assign weather_icon = 'wi-night-alt-thunderstorm' %}{% endif %}
  {% endif %}

{% elsif weather_type == 'A' %}
  {% comment %} HAIL {% endcomment %}
  {% if is_day %}{% assign weather_icon = 'wi-day-hail' %}{% else %}{% assign weather_icon = 'wi-night-alt-hail' %}{% endif %}

{% elsif weather_type == 'F' %}
  {% comment %} FOG {% endcomment %}
  {% if is_day %}{% assign weather_icon = 'wi-day-fog' %}{% else %}{% assign weather_icon = 'wi-night-fog' %}{% endif %}

{% elsif weather_type == 'IF' %}
  {% comment %} ICE FOG {% endcomment %}
  {% if is_day %}{% assign weather_icon = 'wi-day-fog' %}{% else %}{% assign weather_icon = 'wi-night-fog' %}{% endif %}

{% elsif weather_type == 'ZF' %}
  {% comment %} FREEZING FOG {% endcomment %}
  {% if is_day %}{% assign weather_icon = 'wi-day-fog' %}{% else %}{% assign weather_icon = 'wi-night-fog' %}{% endif %}

{% elsif weather_type == 'BR' %}
  {% comment %} MIST {% endcomment %}
  {% if is_day %}{% assign weather_icon = 'wi-day-fog' %}{% else %}{% assign weather_icon = 'wi-night-fog' %}{% endif %}

{% elsif weather_type == 'H' %}
  {% comment %} HAZE {% endcomment %}
  {% if is_day %}{% assign weather_icon = 'wi-day-haze' %}{% else %}{% assign weather_icon = 'wi-night-fog' %}{% endif %}

{% elsif weather_type == 'K' %}
  {% comment %} SMOKE {% endcomment %}
  {% assign weather_icon = 'wi-smoke' %}

{% elsif weather_type == 'BD' %}
  {% comment %} BLOWING DUST {% endcomment %}
  {% assign weather_icon = 'wi-dust' %}

{% elsif weather_type == 'BN' %}
  {% comment %} BLOWING SAND {% endcomment %}
  {% assign weather_icon = 'wi-dust' %}

{% elsif weather_type == 'BY' %}
  {% comment %} BLOWING SPRAY {% endcomment %}
  {% if is_day %}{% assign weather_icon = 'wi-day-windy' %}{% else %}{% assign weather_icon = 'wi-windy' %}{% endif %}

{% elsif weather_type == 'TO' %}
  {% comment %} TORNADO {% endcomment %}
  {% assign weather_icon = 'wi-tornado' %}

{% elsif weather_type == 'FC' %}
  {% comment %} FUNNEL CLOUD {% endcomment %}
  {% assign weather_icon = 'wi-tornado' %}

{% elsif weather_type == 'WP' %}
  {% comment %} WATERSPOUTS {% endcomment %}
  {% assign weather_icon = 'wi-tornado' %}

{% elsif weather_type == 'VA' %}
  {% comment %} VOLCANIC ASH {% endcomment %}
  {% assign weather_icon = 'wi-volcano' %}

{% elsif weather_type == 'FR' %}
  {% comment %} FROST {% endcomment %}
  {% if is_day %}{% assign weather_icon = 'wi-day-sunny' %}{% else %}{% assign weather_icon = 'wi-night-clear' %}{% endif %}

{% elsif weather_type == 'IC' %}
  {% comment %} ICE CRYSTALS {% endcomment %}
  {% assign weather_icon = 'wi-snowflake-cold' %}

{% elsif weather_type == 'UP' %}
  {% comment %} UNKNOWN PRECIPITATION {% endcomment %}
  {% if is_day %}{% assign weather_icon = 'wi-day-showers' %}{% else %}{% assign weather_icon = 'wi-night-alt-showers' %}{% endif %}

{% endif %}

<!-- CLOUD COVERAGE (if no weather type or as fallback) -->
{% if weather_icon == '' %}
  {% if clouds_coded == 'OV' %}
    {% comment %} OVERCAST {% endcomment %}
    {% if is_day %}
      {% assign weather_icon = 'wi-cloudy' %}
    {% else %}
      {% assign weather_icon = 'wi-night-alt-cloudy' %}
    {% endif %}

  {% elsif clouds_coded == 'BK' %}
    {% comment %} MOSTLY CLOUDY {% endcomment %}
    {% if is_day %}
      {% assign weather_icon = 'wi-day-cloudy-high' %}
    {% else %}
      {% assign weather_icon = 'wi-night-alt-cloudy-high' %}
    {% endif %}

  {% elsif clouds_coded == 'SC' %}
    {% comment %} PARTLY CLOUDY {% endcomment %}
    {% if is_day %}
      {% assign weather_icon = 'wi-day-cloudy' %}
    {% else %}
      {% assign weather_icon = 'wi-night-alt-cloudy' %}
    {% endif %}

  {% elsif clouds_coded == 'FW' %}
    {% comment %} FAIR/MOSTLY SUNNY {% endcomment %}
    {% if is_day %}
      {% assign weather_icon = 'wi-day-sunny-overcast' %}
    {% else %}
      {% assign weather_icon = 'wi-night-partly-cloudy' %}
    {% endif %}

  {% elsif clouds_coded == 'CL' %}
    {% comment %} CLEAR {% endcomment %}
    {% if is_day %}
      {% assign weather_icon = 'wi-day-sunny' %}
    {% else %}
      {% assign weather_icon = 'wi-night-clear' %}
    {% endif %}
  {% endif %}
{% endif %}

<!-- FINAL FALLBACK -->
{% if weather_icon == '' %}
  {% if is_day %}
    {% assign weather_icon = 'wi-day-sunny' %}
  {% else %}
    {% assign weather_icon = 'wi-night-clear' %}
  {% endif %}
{% endif %}

<!-- ADD WIND CONDITIONS (if available) -->
{% assign wind_speed = response.ob.windMPH %}
{% if wind_speed >= 25 %}
  {% comment %} High wind - modify icon if not already weather-specific {% endcomment %}
  {% if weather_icon == 'wi-day-cloudy' %}
    {% assign weather_icon = 'wi-day-cloudy-windy' %}
  {% elsif weather_icon == 'wi-night-alt-cloudy' %}
    {% assign weather_icon = 'wi-night-alt-cloudy-windy' %}
  {% elsif weather_icon == 'wi-cloudy' %}
    {% assign weather_icon = 'wi-cloudy-windy' %}
  {% elsif weather_icon == 'wi-day-sunny' %}
    {% assign weather_icon = 'wi-day-windy' %}
  {% endif %}
{% endif %}


  {% comment %} Build the icon URL {% endcomment %}
  {% assign icon_url = 'https://usetrmnl.com/images/plugins/weather/' | append: weather_icon | append: '.svg' %}
  {%- assign system = trmnl.plugin_settings.custom_fields_values.System | default: "imperial" -%}
<div class="layout">  
  <div class="weather-display">
    <!-- Header with Location and Main Temperature -->
    <div class="header-section">
      <div class="location-block">
        <div class="stat-number">{{ trmnl.plugin_settings.custom_fields_values.location_name | default: "My Weather Station"}}</div>
        <p class="update-time">Updated: </p>
        <p class="update-time">{{- response.ob.dateTimeISO | date: "%b %d, %Y, %I:%M %p" -}}</p>
      </div>

      <div class="temp-section">
        <div class="main-icon {{ icon_class }}">
          <img src="{{ icon_url }}" alt="{{ response.ob.weather }}" class="weather-icon">
        </div>
        <div class="main-temp">
          {%- if system == "metric" -%}
            {{- response.ob.tempC | round -}}&deg;
            <span class="feels-like-temp">Feels like {{ response.ob.feelslikeC | round }}&deg;</span>
          {%- else -%}
            {{- response.ob.tempF | round -}}&deg;
            <span class="feels-like-temp">Feels like {{ response.ob.feelslikeF | round }}&deg;</span>
          {%- endif -%}
        </div>
      </div>
    </div>

    <!-- Weather Statistics Grid -->
    <div class="stats-container">
      <!-- Humidity with Dewpoint -->
      <div class="stat-item">
        <div class="stat-icon {{ icon_class }}">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" fill="currentColor"><path d="{{ icon_humidity }}" /></svg>
        </div>
        <div class="stat-content">
          <div class="stat-title">Humidity</div>
          <div class="stat-number">{{- response.ob.humidity -}}<span class="stat-unit">%</span></div>
          {%- if system == "metric" -%}
            <div class="stat-sub">Dewpoint: {{ response.ob.dewpointC | round }}&deg;C</div>
          {%- else -%}
            <div class="stat-sub">Dewpoint: {{ response.ob.dewpointF | round }}&deg;F</div>
          {%- endif -%}
        </div>
      </div>

      <!-- Wind Speed and Direction -->
      <div class="stat-item">
        <div class="stat-icon {{ icon_class }}" style="{{ wind_rotation }}">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" fill="currentColor"><path d="{{ icon_wind_deg }}" /></svg>
        </div>
        <div class="stat-content">
          <div class="stat-title">Wind ({{- response.ob.windDir -}})</div>
          {%- if system == "metric" -%}
            <div class="stat-number">{{- response.ob.windSpeedKPH | round -}}<span class="stat-unit">kph</span></div>
            {%- if response.ob.windGustKPH -%}
              <div class="stat-sub">Gusts to {{ response.ob.windGustKPH | round }} kph</div>
            {%- endif -%}
          {%- else -%}
            <div class="stat-number">{{- response.ob.windSpeedMPH | round -}}<span class="stat-unit">mph</span></div>
            {%- if response.ob.windGustMPH -%}
              <div class="stat-sub">Gusts to {{ response.ob.windGustMPH | round }} mph</div>
            {%- endif -%}
          {%- endif -%}
        </div>
      </div>

      <!-- Daily Precipitation -->
      <div class="stat-item">
        <div class="stat-icon {{ icon_class }}">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" fill="currentColor"><path d="{{ icon_showers }}" /></svg>
        </div>
        <div class="stat-content">
          <div class="stat-title">Precipitation</div>
          {%- if system == "metric" -%}
            <div class="stat-number">{{- response.ob.precipMM | default: 0.0 | round: 1 -}}<span class="stat-unit">mm</span></div>
            {%- else -%}
            <div class="stat-number">{{- response.ob.precipIN | default: 0.0 | round: 2 -}}<span class="stat-unit">in</span></div>
          {%- endif -%}
        </div>
      </div>

      <!-- UV Index -->
      <div class="stat-item">
        <div class="stat-icon {{ icon_class }}">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" fill="currentColor"><path d="{{ icon_hot }}" /></svg>
        </div>
        <div class="stat-content">
          <div class="stat-title">UV Index</div>
          <div class="stat-number">{{- response.ob.uvi | default: response.ob.uv | default: 0 -}}</div>
        </div>
      </div>
    </div>
  </div>
</div>

{%- else -%}
  <!-- Error/Loading State -->
  <div class="weather-display">
    <div class="loading-state">
      <h1 class="loading-title">Loading Weather Data...</h1>
      <p class="loading-message">Please check your plugin configuration. If the URL is correct, your station may still be activating.</p>
    </div>
  </div>
{%- endif -%}
